// ìŠ¤ì¼€ì¤„ê³¼ ê´€ë ¨ëœ ëª¨ë“  ì²˜ë¦¬ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ìœ í‹¸ë¦¬í‹° 

// ì‹œê°„ ë¦¬ì…‹ í•¨ìˆ˜: í•˜ë£¨ì˜ ì‹œì‘ ë˜ëŠ” ëìœ¼ë¡œ ì„¤ì •
export function resetToStartOfDay(date, isEnd = false) {
    const newDate = new Date(date);
    if (isEnd)
      newDate.setHours(23, 59, 59, 999);
    else
      newDate.setHours(0, 0, 0, 0);
    return newDate;
  }
  
  // ìš”ì¼ ë³€í™˜ í•¨ìˆ˜: JS ê¸°ì¤€(ì¼=0) â†’ GPT ê¸°ì¤€(ì›”=1 ~ ì¼=7)
  export function getGptDayIndex(date) {
    const jsDay = date.getDay();
    return jsDay === 0 ? 7 : jsDay;
  }
  
  // ë‚ ì§œ â†’ ISO ë¬¸ìì—´ í¬ë§·
  export function formatLocalISO(date) {
    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}T${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}:00`;
  }

  // ë‚ ì§œ ë¬¸ìì—´ì„ íŒŒì‹±í•˜ì—¬ Date ê°ì²´ë¡œ ë³€í™˜
  export function parseDateString(dateStr, baseDate = new Date()) {
    if (!dateStr) return null;
    
    const today = resetToStartOfDay(baseDate);
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth();
    const currentDate = today.getDate();
    const currentDay = today.getDay(); // 0: ì¼ìš”ì¼, 6: í† ìš”ì¼
    
    // ì´ë²ˆì£¼ í† ìš”ì¼/ì¼ìš”ì¼ íŒ¨í„´ ì²˜ë¦¬
    const thisWeekPattern = /ì´ë²ˆ\s*ì£¼\s*(ì›”|í™”|ìˆ˜|ëª©|ê¸ˆ|í† |ì¼)ìš”ì¼/i;
    const nextWeekPattern = /ë‹¤ìŒ\s*ì£¼\s*(ì›”|í™”|ìˆ˜|ëª©|ê¸ˆ|í† |ì¼)ìš”ì¼/i;
    
    if (thisWeekPattern.test(dateStr)) {
      const match = dateStr.match(thisWeekPattern);
      const targetDay = getKoreanDayIndex(match[1]);
      const daysToAdd = (targetDay - currentDay + 7) % 7;
      
      const result = new Date(today);
      result.setDate(currentDate + daysToAdd);
      return result;
    }
    
    if (nextWeekPattern.test(dateStr)) {
      const match = dateStr.match(nextWeekPattern);
      const targetDay = getKoreanDayIndex(match[1]);
      const daysToAdd = (targetDay - currentDay + 7) % 7 + 7; // ë‹¤ìŒì£¼ë‹ˆê¹Œ +7
      
      const result = new Date(today);
      result.setDate(currentDate + daysToAdd);
      return result;
    }
    
    // "ë‹¤ìŒ Xìš”ì¼", "ì˜¤ëŠ” Xìš”ì¼" íŒ¨í„´ ì²˜ë¦¬
    const nextDayPattern = /ë‹¤ìŒ\s*(ì›”|í™”|ìˆ˜|ëª©|ê¸ˆ|í† |ì¼)ìš”ì¼/i;
    const comingDayPattern = /ì˜¤ëŠ”\s*(ì›”|í™”|ìˆ˜|ëª©|ê¸ˆ|í† |ì¼)ìš”ì¼/i;
    const thisDayPattern = /ì´ë²ˆ\s*(ì›”|í™”|ìˆ˜|ëª©|ê¸ˆ|í† |ì¼)ìš”ì¼/i;
    
    if (nextDayPattern.test(dateStr) || comingDayPattern.test(dateStr)) {
      const match = dateStr.match(nextDayPattern) || dateStr.match(comingDayPattern);
      const targetDay = getKoreanDayIndex(match[1]);
      // í˜„ì¬ ìš”ì¼ì´ ëª©í‘œ ìš”ì¼ë³´ë‹¤ ì‘ìœ¼ë©´ ì´ë²ˆ ì£¼, í¬ê±°ë‚˜ ê°™ìœ¼ë©´ ë‹¤ìŒ ì£¼
      const daysToAdd = currentDay < targetDay 
        ? targetDay - currentDay 
        : 7 - (currentDay - targetDay);
      
      const result = new Date(today);
      result.setDate(currentDate + daysToAdd);
      return result;
    }
    
    if (thisDayPattern.test(dateStr)) {
      const match = dateStr.match(thisDayPattern);
      const targetDay = getKoreanDayIndex(match[1]);
      // ëª©í‘œ ìš”ì¼ì´ í˜„ì¬ ìš”ì¼ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìœ¼ë©´ ë‹¤ìŒ ì£¼, í¬ë©´ ì´ë²ˆ ì£¼
      const daysToAdd = targetDay <= currentDay 
        ? 7 - (currentDay - targetDay) 
        : targetDay - currentDay;
      
      const result = new Date(today);
      result.setDate(currentDate + daysToAdd);
      return result;
    }
    
    // ì—°ë„ë¥¼ í¬í•¨í•œ ë‚ ì§œ íŒ¨í„´ (2023ë…„ 5ì›” 19ì¼)
    const fullDatePattern = /(\d{4})ë…„\s*(\d{1,2})ì›”\s*(\d{1,2})ì¼/;
    if (fullDatePattern.test(dateStr)) {
      const match = dateStr.match(fullDatePattern);
      const year = parseInt(match[1], 10);
      const month = parseInt(match[2], 10) - 1; // ì›”ì€ 0ë¶€í„° ì‹œì‘
      const day = parseInt(match[3], 10);
      
      return new Date(year, month, day);
    }
    
    // Xì›” XXì¼ íŒ¨í„´ ì²˜ë¦¬
    const monthDayPattern = /(\d{1,2})ì›”\s*(\d{1,2})ì¼/;
    if (monthDayPattern.test(dateStr)) {
      const match = dateStr.match(monthDayPattern);
      const month = parseInt(match[1], 10) - 1; // ì›”ì€ 0ë¶€í„° ì‹œì‘
      const day = parseInt(match[2], 10);
      
      let year = currentYear;
      // í˜„ì¬ ì›”ë³´ë‹¤ ì‘ìœ¼ë©´ ë‚´ë…„ìœ¼ë¡œ ì„¤ì •
      if (month < currentMonth || (month === currentMonth && day < currentDate)) {
        year += 1;
      }
      
      return new Date(year, month, day);
    }
    
    // Nì¼ í›„ íŒ¨í„´ ì²˜ë¦¬
    const daysLaterPattern = /(\d+)ì¼\s*(í›„|ë’¤)/;
    if (daysLaterPattern.test(dateStr)) {
      const match = dateStr.match(daysLaterPattern);
      const daysToAdd = parseInt(match[1], 10);
      
      const result = new Date(today);
      result.setDate(currentDate + daysToAdd);
      return result;
    }
    
    // Nì£¼ í›„ íŒ¨í„´ ì²˜ë¦¬
    const weeksLaterPattern = /(\d+)ì£¼\s*(í›„|ë’¤)/;
    if (weeksLaterPattern.test(dateStr)) {
      const match = dateStr.match(weeksLaterPattern);
      const weeksToAdd = parseInt(match[1], 10);
      
      const result = new Date(today);
      result.setDate(currentDate + (weeksToAdd * 7));
      return result;
    }
    
    return null;
  }
  
  // í•œêµ­ì–´ ìš”ì¼ ì´ë¦„ì„ ìˆ«ì ì¸ë±ìŠ¤ë¡œ ë³€í™˜ (ì›”:1 ~ ì¼:7)
  function getKoreanDayIndex(dayName) {
    const days = {
      'ì›”': 1, 'í™”': 2, 'ìˆ˜': 3, 'ëª©': 4, 'ê¸ˆ': 5, 'í† ': 6, 'ì¼': 7
    };
    return days[dayName] || 0;
  }
  
  // GPT í”„ë¡¬í”„íŠ¸: ìƒˆ ì‹œê°„í‘œ ìƒì„±ìš©
  export function buildShedAIPrompt(lifestyleText, taskText, today) {
    const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
    const gptDayIndex = getGptDayIndex(today); // ì›”=1 ~ ì¼=7
    const dayName = dayNames[today.getDay()];
    const dateStr = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼`;
    const nowTime = `${today.getHours()}ì‹œ ${today.getMinutes()}ë¶„`;
  
    const prefix =
  `ë‹¹ì‹ ì€ ì‚¬ìš©ìì˜ ìƒí™œ íŒ¨í„´ê³¼ í•  ì¼, ê·¸ ì™¸ í”¼ë“œë°±ì„ ë°”íƒ•ìœ¼ë¡œ,
ì‚¬ìš©ìì—ê²Œ ìµœì í™”ëœ íš¨ìœ¨ì ì¸ ìŠ¤ì¼€ì¤„ì„ ì„¤ê³„í•´ì£¼ëŠ” ê³ ê¸‰ ì¼ì • ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ë‹¹ì‹ ì˜ ëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
- ë‹¨ìˆœíˆ ë¹ˆ ì‹œê°„ì„ ì±„ìš°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì‚¬ìš©ìì˜ ìƒí™©ê³¼ ìš°ì„ ìˆœìœ„ë¥¼ ì •í™•íˆ ë¶„ì„í•˜ì—¬ "ì™€, ì§„ì§œ ë‚´ ìƒí™©ì— ë§ëŠ” ì¼ì •ì´ë‹¤!"ë¼ê³  ëŠê»´ì§ˆ ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•©ë‹ˆë‹¤.
- í˜„ì‹¤ì ìœ¼ë¡œ ì‹¤í˜„ ê°€ëŠ¥í•œ ì‹œê°„í‘œë¥¼ ì„¤ê³„í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ë¹ˆ ì‹œê°„ì´ë¼ê³  ë¬´ì¡°ê±´ ì¼ì •ì„ ì±„ìš°ì§€ ë§ê³ , ì´ì „ ì¼ì •ë“¤ë„ í™•ì¸í•˜ì—¬ ì–¸ì œ ì‰¬ê³ , ì–¸ì œ ì¶”ê°€í•˜ëŠ” ê²Œ ì í•©í•œì§€ë¥¼ í•¨ê»˜ ê³„ì‚°í•˜ì„¸ìš”.

ê¸°ë³¸ ì„¤ê³„ ì›ì¹™
1. ì‚¬ìš©ìëŠ” ìì—°ì–´ë¡œ [ìƒí™œ íŒ¨í„´]ê³¼ [í•  ì¼ ëª©ë¡]ì„ ì…ë ¥í•©ë‹ˆë‹¤.  
   ì´ë¥¼ ë¶„ë¦¬ ë° êµ¬ì¡°í™”í•œ í›„, ì „ì²´ ìŠ¤ì¼€ì¤„ì„ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.

2. ìƒí™œ íŒ¨í„´(ìˆ˜ë©´, ì‹ì‚¬, íšŒì‚¬ ì¼ì • ë“±)ì€ **ê³ ì •ëœ ì¼ì •**ìœ¼ë¡œ ê°„ì£¼ë˜ë©°, ì ˆëŒ€ ì¹¨ë²”í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.  
   ìš°ì„ ì ìœ¼ë¡œ í•´ë‹¹ ì‹œê°„ëŒ€ì— ë°°ì¹˜í•˜ê³ , ë‚¨ëŠ” ì‹œê°„(ììœ  ì‹œê°„)ì—ë§Œ í•  ì¼ì„ ë°°ì¹˜í•˜ì„¸ìš”.
   
   **ì¤‘ìš”í•œ ìƒí™œ íŒ¨í„´ ê·œì¹™:**
   - **ì¶œê·¼/íšŒì‚¬ ì—…ë¬´**: ì˜¤ì§ í‰ì¼(day:1~5)ì—ë§Œ ë°°ì¹˜
   - **ì£¼ë§(day:6, day:7)**: ì¶œê·¼, íšŒì‚¬ ì—…ë¬´, ì—…ë¬´ ê´€ë ¨ í™œë™ ì ˆëŒ€ ê¸ˆì§€
   - **ìˆ˜ë©´ íŒ¨í„´**: ìš”ì¼ë³„ë¡œ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ (ì˜ˆ: ì£¼ë§ ëŠ¦ì )
   - **ì‹ì‚¬ íŒ¨í„´**: ìš”ì¼ë³„ë¡œ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ (ì˜ˆ: ì£¼ë§ ëŠ¦ì€ ì•„ì¹¨)

3. í•  ì¼ ëª©ë¡ì€ ë‹¤ìŒ ê¸°ì¤€ì— ë”°ë¼ ë°°ì¹˜í•©ë‹ˆë‹¤:
   - **ì¤‘ìš”ë„**ì™€ **ê¸´ê¸‰ë„**ë¥¼ Eisenhower Matrixë¡œ ë¶„ì„í•˜ì—¬ ìš°ì„ ìˆœìœ„ ì§€ì •
     - 1ìˆœìœ„: ì¤‘ìš” + ê¸´ê¸‰ â†’ ì¦‰ì‹œ ì²˜ë¦¬
     - 2ìˆœìœ„: ì¤‘ìš” + ì—¬ìœ  â†’ ê³„íšì  ë°°ì¹˜
     - 3ìˆœìœ„: ëœ ì¤‘ìš” + ê¸´ê¸‰ â†’ í‹ˆí‹ˆì´ ì²˜ë¦¬
     - 4ìˆœìœ„: ëœ ì¤‘ìš” + ì—¬ìœ  â†’ í•„ìš” ì‹œ ë°°ì¹˜
   - **ë§ˆê°ì¼ì´ ê°€ê¹Œìš¸ìˆ˜ë¡ ê¸´ê¸‰ë„ ìƒìŠ¹**
   - **ë‚œì´ë„ì— ë”°ë¼ ì‰¬ëŠ” ì‹œê°„ ë°˜ì˜**:
     - ìƒ: ìµœì†Œ 30ë¶„
     - ì¤‘: ìµœì†Œ 20ë¶„
     - í•˜: ìµœì†Œ 10~15ë¶„
     - ì‰¬ëŠ” ì‹œê°„ì˜ ê²½ìš° ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ê¸°ì¤€ê°’ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì´ ìµœìš°ì„ ì´ë‹ˆ ìŠì§€ ë§ˆì„¸ìš”. ì§€ê¸ˆ ì£¼ì–´ì§„ ì‰¬ëŠ”ì‹œê°„ì€ ê¸°ì¤€ ê°’ì…ë‹ˆë‹¤.
     - ì„¤ëª…ì— ìˆëŠ” í‚¤ì›Œë“œ(ë²¼ë½ì¹˜ê¸°, ì‹œí—˜, ë°œí‘œ, ê°œë… ë³µìŠµ ë“±)ë¥¼ ê³ ë ¤í•´ì„œ ì‘ì—…ì„ ì„¸ë¶„í™”í•˜ê³  ë°˜ë³µ í•™ìŠµ ë˜ëŠ” ì¤€ë¹„-ì‹¤í–‰-ì •ë¦¬ íë¦„ì´ ìˆë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

4. ìŠ¤ì¼€ì¤„ ìƒì„± ì‹œ ë‹¤ìŒì„ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤:
   - í™œë™ ê°„ ì‹œê°„ëŒ€ **ì ˆëŒ€ ì¤‘ë³µ ê¸ˆì§€**
   - í•˜ë£¨ì— **ëª°ì… í™œë™ì€ 2ì‹œê°„ ì´ìƒ ì—°ì† ë°°ì¹˜**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•¨
   - ë‹¨, í•˜ë£¨ 3~4ì‹œê°„ ì´ìƒ ì—°ì† ëª°ì•„ì¹˜ëŠ” ì‘ì—…ì€ í”¼í•˜ê³  ë¶„ì‚°
   - í•˜ë£¨ ì¼ê³¼ê°€ ê³¼ë°€í•˜ì§€ ì•Šë„ë¡ ì ì ˆí•œ ê°„ê²© í™•ë³´

5. ìš”ì¼ ê³„ì‚° ê·œì¹™
   - \`day:1\`ì€ **ì›”ìš”ì¼**ì´ê³ , ì˜¤ëŠ˜ì´ ìˆ˜ìš”ì¼ì´ë©´ \`day:3\`
   - "ì˜¤ëŠ˜"ì´ë¼ëŠ” í‘œí˜„ì€ ë°˜ë“œì‹œ í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ \`day:x\`ë¡œ í™˜ì‚°
   - ì‹¤ì œ ë‚ ì§œ("5ì›” 19ì¼")ëŠ” ì‚¬ìš©ìì˜ ì…ë ¥ì—ì„œ íŒŒì•…í•˜ì—¬ \`day:x\`ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©
   - ëª¨ë“  \`day:x\`ëŠ” **ì˜¤ëŠ˜ë¶€í„° ì˜¤ë¦„ì°¨ìˆœ(day:3 â†’ day:4 â†’ ... â†’ day:14)**ìœ¼ë¡œë§Œ ì¶œë ¥. ì ˆëŒ€ ë˜ëŒì•„ê°€ë©´ ì•ˆ ë¨.

6. ì£¼ë§ ë° ë°˜ë³µ ì¼ì • ì²˜ë¦¬
   - **í‰ì¼** = day:1~5 (ì›”ìš”ì¼~ê¸ˆìš”ì¼), **ì£¼ë§** = day:6~7 (í† ìš”ì¼, ì¼ìš”ì¼)
   - **ì¤‘ìš”**: ì£¼ë§(day:6, day:7)ì—ëŠ” ì¶œê·¼, íšŒì‚¬ ì—…ë¬´ ë“± í‰ì¼ ì „ìš© í™œë™ì„ ì ˆëŒ€ ë°°ì¹˜í•˜ì§€ ë§ˆì„¸ìš”
   - ìƒí™œ íŒ¨í„´ì´ ë°˜ë³µë  ê²½ìš°(ì˜ˆ: í‰ì¼ 23:00~06:30 ìˆ˜ë©´), í•´ë‹¹ ìš”ì¼ì— ë°˜ë³µ ë°°ì¹˜
   - ìš´ë™ ë“± ìŠµê´€ì„± í™œë™ì€ **ë˜ë„ë¡ ë™ì¼ ì‹œê°„ëŒ€ì— ë°˜ë³µ**
   - ì£¼ë§ì—ëŠ” íœ´ì‹, ì·¨ë¯¸, ê°€ì¡± ì‹œê°„ ë“± ì—¬ê°€ í™œë™ì— ì§‘ì¤‘í•˜ì„¸ìš”

ì˜¤ëŠ˜ ë‚ ì§œëŠ” ${dateStr} ${dayName}(day:${gptDayIndex})ìš”ì¼ì´ë©°, í˜„ì¬ ì‹œê° ${nowTime}ì´í›„ë¶€í„°ì˜ ì‹œê°„ëŒ€ì—ë§Œ í•  ì¼ì„ ë°°ì¹˜í•˜ì„¸ìš”. ì´ì „ ì‹œê°„ì€ ì´ë¯¸ ì§€ë‚¬ìœ¼ë¯€ë¡œ ì œì™¸í•˜ì„¸ìš”.

ğŸ“Œ ë§ˆê°ì¼ ì²˜ë¦¬ ë°©ì‹ ì•ˆë‚´:
- ë‚ ì§œ ê¸°ë°˜ ë§ˆê°ì¼("5ì›” 19ì¼ ì˜¤ì „ 9ì‹œ", "5ì›” 28ì¼ê¹Œì§€")ì´ ì£¼ì–´ì§ˆ ê²½ìš°,
  ë°˜ë“œì‹œ ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ day:x ê°’ì„ ê³„ì‚°í•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- ì˜ˆ: ì˜¤ëŠ˜ì´ 5ì›” 15ì¼(day:4)ì´ê³ , ë§ˆê°ì¼ì´ 5ì›” 19ì¼ì´ë©´ â†’ day:8ì…ë‹ˆë‹¤.
- "ì´ë²ˆì£¼ í† ìš”ì¼"ì´ë‚˜ "ë‹¤ìŒì£¼ ì›”ìš”ì¼"ê³¼ ê°™ì€ ìƒëŒ€ì  ë‚ ì§œ í‘œí˜„ë„ ë°˜ë“œì‹œ ì •í™•íˆ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤.
- ì¤‘ìš”: ë§ˆê°ì¼ í‘œí˜„ ë’¤ì— "(day:X)" í˜•ì‹ìœ¼ë¡œ ì´ë¯¸ ê³„ì‚°ëœ ë‚ ì§œê°€ ìˆë‹¤ë©´, ë°˜ë“œì‹œ ê·¸ ê°’ì„ ì‚¬ìš©í•˜ì„¸ìš”.
  ì˜ˆ: "ì´ë²ˆì£¼ í† ìš”ì¼ (day:10)"ì´ë¼ë©´ ë°˜ë“œì‹œ day:10ì„ ë§ˆê°ì¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.
- ëª¨ë“  í•  ì¼ì€ ì´ ìƒëŒ€ day:x ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ì •í™•íˆ ìŠ¤ì¼€ì¤„ë§í•´ì•¼ í•˜ë©°,
  ë§ˆê°ì¼ì„ ì´ˆê³¼í•œ ì¼ì • ë°°ì¹˜ëŠ” ì ˆëŒ€ë¡œ í•˜ì§€ ë§ˆì„¸ìš”.

ëª¨ë“  í•  ì¼ì€ ë°˜ë“œì‹œ ì˜¤ëŠ˜(day:${gptDayIndex})ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒëŒ€ì  ë§ˆê°ì¼ì„ day ìˆ«ìë¡œ í™˜ì‚°í•˜ì—¬, 
í•´ë‹¹ ë§ˆê°ì¼ê¹Œì§€ day:14, day:15 ë“± í•„ìš”í•œ ë§Œí¼ ìŠ¤ì¼€ì¤„ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
ì¤‘ìš”í•˜ê±°ë‚˜ ë§ˆê°ì´ ì„ë°•í•œ ì¼ì€ ì˜¤ëŠ˜ë¶€í„° ë°”ë¡œ ì‹œì‘í•˜ê³ ,
**ì ˆëŒ€ë¡œ day:7ê¹Œì§€ë§Œ ì¶œë ¥í•˜ê±°ë‚˜ ì¤‘ê°„ì— ë©ˆì¶”ì§€ ë§ˆì„¸ìš”.
- ì¼ì •ì´ day:14 ë˜ëŠ” ê·¸ ì´ì „ì—ì„œ ì¢…ë£Œë˜ë”ë¼ë„, ê·¸ ì´ìœ ë¥¼ ë°˜ë“œì‹œ notesì— ì„¤ëª…í•˜ì„¸ìš”.
- ì˜ˆ: "í•  ì¼ì˜ ì´ ì†Œìš” ì‹œê°„ì´ ì¶©ë¶„íˆ ë¶„ì‚°ë˜ì–´ day:10ê¹Œì§€ë§Œ ê³„íší•˜ë©´ ë©ë‹ˆë‹¤."
- ê³„íšì´ ì§§ê²Œ ëë‚œ ê²½ìš°, ì‚¬ìš©ìê°€ ë¶ˆì•ˆí•´í•˜ì§€ ì•Šë„ë¡ **ì™œ ë” ì´ìƒ ë°°ì¹˜í•˜ì§€ ì•Šì•˜ëŠ”ì§€ ë°˜ë“œì‹œ notesì— í¬í•¨**í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸ“Š í™œë™ ë¹„ì¤‘ ë¶„ì„ ìš”êµ¬ì‚¬í•­
- ìŠ¤ì¼€ì¤„ ìƒì„±ê³¼ í•¨ê»˜ ì‚¬ìš©ìì˜ í™œë™ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ í™œë™ ë¹„ì¤‘ì„ ê³„ì‚°í•´ì£¼ì„¸ìš”.
- ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ë³„ë¡œ í™œë™ ì‹œê°„ì„ ì§‘ê³„í•˜ì—¬ ë¹„ì¤‘ì„ ê³„ì‚°í•˜ì„¸ìš”:
  - work: ì—…ë¬´, ê°œë°œ, ì½”ë”©, íšŒì‚¬ ê´€ë ¨ í™œë™
  - study: ê³µë¶€, í•™ìŠµ, ì‹œí—˜ ì¤€ë¹„, ê°•ì˜ ê´€ë ¨ í™œë™
  - exercise: ìš´ë™, í—¬ìŠ¤, ëŸ¬ë‹, ìš”ê°€ ë“± ì‹ ì²´ í™œë™
  - reading: ë…ì„œ, ì±… ì½ê¸° ê´€ë ¨ í™œë™
  - hobby: ì·¨ë¯¸, ê²Œì„, ìŒì•…, ì—¬ê°€ í™œë™
  - others: ê¸°íƒ€ í™œë™ë“¤
- ê° ì¹´í…Œê³ ë¦¬ì˜ ë¹„ì¤‘ì€ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì´ í™œë™ ì‹œê°„ì„ ì „ì²´ í™œë™ ì‹œê°„ìœ¼ë¡œ ë‚˜ëˆˆ ë¹„ìœ¨ë¡œ ê³„ì‚°í•˜ì„¸ìš”.

ğŸ“¤ ì¶œë ¥ í˜•ì‹ í•„ìˆ˜ ì§€ì¹¨ (â€» ì´ ë¶€ë¶„ì´ ë§¤ìš° ì¤‘ìš”)
- ì¶œë ¥ì€ ë°˜ë“œì‹œ ì•„ë˜ì™€ ê°™ì€ **JSON í˜•ì‹ í•˜ë‚˜ë§Œ ë°˜í™˜**í•˜ì„¸ìš”.
- **ê° dayë³„ë¡œ í•˜ë‚˜ì˜ ê°ì²´**ê°€ ìˆì–´ì•¼ í•˜ë©°, ê° ê°ì²´ëŠ” ë°˜ë“œì‹œ ì•„ë˜ í•„ë“œë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
  - \`day\`: ì˜¤ëŠ˜ ê¸°ì¤€ ìƒëŒ€ ë‚ ì§œ ë²ˆí˜¸ (ì •ìˆ˜, ì˜¤ë¦„ì°¨ìˆœ)
  - \`weekday\`: í•´ë‹¹ ìš”ì¼ ì´ë¦„ (ì˜ˆ: "ìˆ˜ìš”ì¼")
  - \`activities\`: ë°°ì—´ í˜•íƒœë¡œ í™œë™ ëª©ë¡
    - ê° í™œë™ì€ \`start\`, \`end\`, \`title\`, \`type\` í•„ë“œ í¬í•¨
      - \`type\`ì€ "lifestyle" ë˜ëŠ” "task" ì¤‘ í•˜ë‚˜
- **ì ˆëŒ€ í™œë™ë³„ë¡œ days ë°°ì—´ì„ ë°˜í™˜í•˜ì§€ ë§ˆì„¸ìš”!**
- ë°˜ë“œì‹œ ì•„ë˜ ì˜ˆì‹œì²˜ëŸ¼ dayë³„ë¡œ activitiesë¥¼ ë¬¶ì–´ì„œ ë°˜í™˜í•˜ì„¸ìš”.

ì˜ˆì‹œ:
\`\`\`json
{
  "schedule": [
    {
      "day": 3,
      "weekday": "ìˆ˜ìš”ì¼",
      "activities": [
        { "start": "06:00", "end": "07:00", "title": "íšŒì‚¬ ì¤€ë¹„", "type": "lifestyle" },
        { "start": "08:00", "end": "17:00", "title": "ê·¼ë¬´", "type": "lifestyle" },
        { "start": "19:00", "end": "21:00", "title": "ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹¤ê¸° ê°œë… ì•”ê¸°", "type": "task" },
        { "start": "21:00", "end": "22:00", "title": "ìš´ë™", "type": "lifestyle" }
      ]
    },
    {
      "day": 4,
      "weekday": "ëª©ìš”ì¼",
      "activities": [
        { "start": "06:00", "end": "07:00", "title": "íšŒì‚¬ ì¤€ë¹„", "type": "lifestyle" },
        { "start": "08:00", "end": "17:00", "title": "ê·¼ë¬´", "type": "lifestyle" },
        { "start": "19:00", "end": "21:00", "title": "ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹¤ê¸° ê°œë… ì•”ê¸°", "type": "task" }
      ]
    }
    // ... day:14ê¹Œì§€ ë°˜ë³µ
  ],
  "activityAnalysis": {
    "work": 45,
    "study": 20,
    "exercise": 10,
    "reading": 5,
    "hobby": 5,
    "others": 15
  },
  "notes": [
    "ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹œí—˜ì´ 4ì¼ ë‚¨ì•„ ìˆì–´ ìƒìœ„ ìš°ì„ ìˆœìœ„ë¡œ ë°°ì¹˜í•¨.",
    "ìƒí™œ íŒ¨í„´ê³¼ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ë¹ˆ ì‹œê°„ëŒ€ë¥¼ í™œìš©í•˜ì—¬ ë¶„ì‚° êµ¬ì„±.",
    "ìš´ë™ì€ ë§¤ì¼ ì €ë… ê°™ì€ ì‹œê°„ëŒ€ì— ë°˜ë³µ ë°°ì¹˜í•˜ì—¬ ìŠµê´€ í˜•ì„± ìœ ë„."
  ]
}
\`\`\`
- **ì´ ì˜ˆì‹œì™€ ì™„ì „íˆ ë™ì¼í•œ êµ¬ì¡°ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.**
- dayë³„ë¡œ activitiesë¥¼ ë¬¶ì–´ì„œ, ê° dayê°€ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ë°°ì—´ì— ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.
- ë‹¤ë¥¸ í˜•ì‹(í™œë™ë³„ days ë°°ì—´, í…ìŠ¤íŠ¸ ëª©ë¡, ì˜µì…˜1/2 êµ¬ë¶„ ë“±)ì€ ì ˆëŒ€ ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”.
- ì ˆëŒ€ë¡œ "ììœ ì‹œê°„", "Free time", "ë¹ˆ ì‹œê°„" ë“±ê³¼ ê°™ì´ ì•„ë¬´ í™œë™ì´ ì—†ëŠ” ì‹œê°„ëŒ€ë¥¼ ë³„ë„ì˜ í™œë™ìœ¼ë¡œ ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”.
- ì˜¤ì§ ì‹¤ì œ í™œë™(ìˆ˜ë©´, ì‹ì‚¬, íšŒì‚¬, í•  ì¼ ë“±)ë§Œ activitiesì— í¬í•¨í•˜ì„¸ìš”.
- ë¹ˆ ì‹œê°„ì€ activities ë°°ì—´ì— í¬í•¨í•˜ì§€ ì•Šê³ , ë‹¨ìˆœíˆ ë¹„ì›Œë‘ì„¸ìš”.

ê° í™œë™(activity)ì—ëŠ” ë°˜ë“œì‹œ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ type ê°’ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
- ìƒí™œ íŒ¨í„´ì—ì„œ ìœ ë˜í•œ ì¼ì •: "type": "lifestyle"
- í•  ì¼ì´ë‚˜ ìœ ë™ì ì¸ ì‘ì—…: "type": "task"
ì´ ê°’ì€ ë°˜ë“œì‹œ JSON ê°ì²´ì˜ ê° activityì— í¬í•¨ë˜ì–´ì•¼ í•˜ë©°, ë Œë”ë§ ë° í•„í„°ë§ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
  `;
  
    return `${prefix}\n[ìƒí™œ íŒ¨í„´]\n${lifestyleText}\n\n[í•  ì¼ ëª©ë¡]\n${taskText}`;
  }
  
  // GPT í”„ë¡¬í”„íŠ¸: ê¸°ì¡´ ì‹œê°„í‘œ ìˆ˜ì •ìš©
  export function buildFeedbackPrompt(lifestyleText, taskText, previousSchedule) {
    // ê¸°ì¡´ ì¼ì •ì˜ ìµœëŒ€ ì¼ìˆ˜ í™•ì¸
    let maxDay = 0;
    if (previousSchedule && Array.isArray(previousSchedule)) {
      previousSchedule.forEach(day => {
        if (day.day > maxDay) maxDay = day.day;
      });
    }
    
    const prefix =
  `ë‹¹ì‹ ì€ ì‚¬ìš©ìì˜ ìƒí™œ íŒ¨í„´ê³¼ í•  ì¼, ê·¸ ì™¸ í”¼ë“œë°±ì„ ë°”íƒ•ìœ¼ë¡œ,
ì‚¬ìš©ìì—ê²Œ ìµœì í™”ëœ íš¨ìœ¨ì ì¸ ìŠ¤ì¼€ì¤„ì„ ì„¤ê³„í•´ì£¼ëŠ” ê³ ê¸‰ ì¼ì • ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

í”¼ë“œë°± ê¸°ë°˜ ì¼ì • ìˆ˜ì •
- ê¸°ì¡´ ìŠ¤ì¼€ì¤„ì´ ì œê³µëœ ê²½ìš°, **ìˆ˜ì • ìš”ì²­ì´ ì—†ëŠ” í™œë™ì€ ìœ ì§€**
- ê¸°ì¡´ ë§ˆê°ì¼ì„ ì¡°ê¸° ì¢…ë£Œí•˜ê±°ë‚˜ ì‚­ì œí•˜ì§€ ë§ê³ , ìƒˆ ì‘ì—…ë§Œ ë³‘í•©í•˜ì—¬ ì¬ì¡°ì •
- ì˜ˆ: ê¸°ì¡´ ì‘ì—…ì´ day:14ê¹Œì§€ ê³„íšë¼ ìˆì—ˆë‹¤ë©´, ìˆ˜ì • í›„ì—ë„ day:14ê¹Œì§€ ìœ ì§€

ê¸°ë³¸ ì„¤ê³„ ì›ì¹™
1. ì‚¬ìš©ìëŠ” ìì—°ì–´ë¡œ [ìƒí™œ íŒ¨í„´]ê³¼ [í•  ì¼ ëª©ë¡]ì„ ì…ë ¥í•©ë‹ˆë‹¤.  
   ì´ë¥¼ ë¶„ë¦¬ ë° êµ¬ì¡°í™”í•œ í›„, ì „ì²´ ìŠ¤ì¼€ì¤„ì„ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.

2. ìƒí™œ íŒ¨í„´(ìˆ˜ë©´, ì‹ì‚¬, íšŒì‚¬ ì¼ì • ë“±)ì€ **ê³ ì •ëœ ì¼ì •**ìœ¼ë¡œ ê°„ì£¼ë˜ë©°, ì ˆëŒ€ ì¹¨ë²”í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.  
   ìš°ì„ ì ìœ¼ë¡œ í•´ë‹¹ ì‹œê°„ëŒ€ì— ë°°ì¹˜í•˜ê³ , ë‚¨ëŠ” ì‹œê°„(ììœ  ì‹œê°„)ì—ë§Œ í•  ì¼ì„ ë°°ì¹˜í•˜ì„¸ìš”.
   
   **ì¤‘ìš”í•œ ìƒí™œ íŒ¨í„´ ê·œì¹™:**
   - **ì¶œê·¼/íšŒì‚¬ ì—…ë¬´**: ì˜¤ì§ í‰ì¼(day:1~5)ì—ë§Œ ë°°ì¹˜
   - **ì£¼ë§(day:6, day:7)**: ì¶œê·¼, íšŒì‚¬ ì—…ë¬´, ì—…ë¬´ ê´€ë ¨ í™œë™ ì ˆëŒ€ ê¸ˆì§€
   - **ìˆ˜ë©´ íŒ¨í„´**: ìš”ì¼ë³„ë¡œ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ (ì˜ˆ: ì£¼ë§ ëŠ¦ì )
   - **ì‹ì‚¬ íŒ¨í„´**: ìš”ì¼ë³„ë¡œ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ (ì˜ˆ: ì£¼ë§ ëŠ¦ì€ ì•„ì¹¨)

3. í•  ì¼ ëª©ë¡ì€ ë‹¤ìŒ ê¸°ì¤€ì— ë”°ë¼ ë°°ì¹˜í•©ë‹ˆë‹¤:
   - **ì¤‘ìš”ë„**ì™€ **ê¸´ê¸‰ë„**ë¥¼ Eisenhower Matrixë¡œ ë¶„ì„í•˜ì—¬ ìš°ì„ ìˆœìœ„ ì§€ì •
     - 1ìˆœìœ„: ì¤‘ìš” + ê¸´ê¸‰ â†’ ì¦‰ì‹œ ì²˜ë¦¬
     - 2ìˆœìœ„: ì¤‘ìš” + ì—¬ìœ  â†’ ê³„íšì  ë°°ì¹˜
     - 3ìˆœìœ„: ëœ ì¤‘ìš” + ê¸´ê¸‰ â†’ í‹ˆí‹ˆì´ ì²˜ë¦¬
     - 4ìˆœìœ„: ëœ ì¤‘ìš” + ì—¬ìœ  â†’ í•„ìš” ì‹œ ë°°ì¹˜
   - **ë§ˆê°ì¼ì´ ê°€ê¹Œìš¸ìˆ˜ë¡ ê¸´ê¸‰ë„ ìƒìŠ¹**
   - **ë‚œì´ë„ì— ë”°ë¼ ì‰¬ëŠ” ì‹œê°„ ë°˜ì˜**:
     - ìƒ: ìµœì†Œ 30ë¶„
     - ì¤‘: ìµœì†Œ 20ë¶„
     - í•˜: ìµœì†Œ 10~15ë¶„
     - ì‰¬ëŠ” ì‹œê°„ì˜ ê²½ìš° ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ê¸°ì¤€ê°’ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì´ ìµœìš°ì„ ì´ë‹ˆ ìŠì§€ ë§ˆì„¸ìš”. ì§€ê¸ˆ ì£¼ì–´ì§„ ì‰¬ëŠ”ì‹œê°„ì€ ê¸°ì¤€ ê°’ì…ë‹ˆë‹¤.
     - ì„¤ëª…ì— ìˆëŠ” í‚¤ì›Œë“œ(ë²¼ë½ì¹˜ê¸°, ì‹œí—˜, ë°œí‘œ, ê°œë… ë³µìŠµ ë“±)ë¥¼ ê³ ë ¤í•´ì„œ ì‘ì—…ì„ ì„¸ë¶„í™”í•˜ê³  ë°˜ë³µ í•™ìŠµ ë˜ëŠ” ì¤€ë¹„-ì‹¤í–‰-ì •ë¦¬ íë¦„ì´ ìˆë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

4. ìŠ¤ì¼€ì¤„ ìƒì„± ì‹œ ë‹¤ìŒì„ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤:
   - í™œë™ ê°„ ì‹œê°„ëŒ€ **ì ˆëŒ€ ì¤‘ë³µ ê¸ˆì§€**
   - í•˜ë£¨ì— **ëª°ì… í™œë™ì€ 2ì‹œê°„ ì´ìƒ ì—°ì† ë°°ì¹˜**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•¨
   - ë‹¨, í•˜ë£¨ 3~4ì‹œê°„ ì´ìƒ ì—°ì† ëª°ì•„ì¹˜ëŠ” ì‘ì—…ì€ í”¼í•˜ê³  ë¶„ì‚°
   - í•˜ë£¨ ì¼ê³¼ê°€ ê³¼ë°€í•˜ì§€ ì•Šë„ë¡ ì ì ˆí•œ ê°„ê²© í™•ë³´

5. ìš”ì¼ ê³„ì‚° ê·œì¹™
   - \`day:1\`ì€ **ì›”ìš”ì¼**ì´ê³ , ì˜¤ëŠ˜ì´ ìˆ˜ìš”ì¼ì´ë©´ \`day:3\`
   - "ì˜¤ëŠ˜"ì´ë¼ëŠ” í‘œí˜„ì€ ë°˜ë“œì‹œ í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ \`day:x\`ë¡œ í™˜ì‚°
   - ì‹¤ì œ ë‚ ì§œ("5ì›” 19ì¼")ëŠ” ì‚¬ìš©ìì˜ ì…ë ¥ì—ì„œ íŒŒì•…í•˜ì—¬ \`day:x\`ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©
   - ëª¨ë“  \`day:x\`ëŠ” **ì˜¤ëŠ˜ë¶€í„° ì˜¤ë¦„ì°¨ìˆœ(day:3 â†’ day:4 â†’ ... â†’ day:14)**ìœ¼ë¡œë§Œ ì¶œë ¥. ì ˆëŒ€ ë˜ëŒì•„ê°€ë©´ ì•ˆ ë¨.

6. ì£¼ë§ ë° ë°˜ë³µ ì¼ì • ì²˜ë¦¬
   - **í‰ì¼** = day:1~5 (ì›”ìš”ì¼~ê¸ˆìš”ì¼), **ì£¼ë§** = day:6~7 (í† ìš”ì¼, ì¼ìš”ì¼)
   - **ì¤‘ìš”**: ì£¼ë§(day:6, day:7)ì—ëŠ” ì¶œê·¼, íšŒì‚¬ ì—…ë¬´ ë“± í‰ì¼ ì „ìš© í™œë™ì„ ì ˆëŒ€ ë°°ì¹˜í•˜ì§€ ë§ˆì„¸ìš”
   - ìƒí™œ íŒ¨í„´ì´ ë°˜ë³µë  ê²½ìš°(ì˜ˆ: í‰ì¼ 23:00~06:30 ìˆ˜ë©´), í•´ë‹¹ ìš”ì¼ì— ë°˜ë³µ ë°°ì¹˜
   - ìš´ë™ ë“± ìŠµê´€ì„± í™œë™ì€ **ë˜ë„ë¡ ë™ì¼ ì‹œê°„ëŒ€ì— ë°˜ë³µ**
   - ì£¼ë§ì—ëŠ” íœ´ì‹, ì·¨ë¯¸, ê°€ì¡± ì‹œê°„ ë“± ì—¬ê°€ í™œë™ì— ì§‘ì¤‘í•˜ì„¸ìš”

âš ï¸ ì¤‘ìš”: ë°˜ë“œì‹œ í˜„ì¬ ì¼ì •ì˜ ì „ì²´ ë‚ ì§œ ë²”ìœ„ë¥¼ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤. ê¸°ì¡´ ì¼ì •ì´ day:${maxDay}ê¹Œì§€ ìˆì—ˆë‹¤ë©´,
ìƒˆ ì¼ì •ë„ ìµœì†Œí•œ day:${maxDay}ê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. ì ˆëŒ€ë¡œ ì¼ì •ì„ 7ì¼ ì´í•˜ë¡œ ì¤„ì´ì§€ ë§ˆì„¸ìš”.

ğŸ“Š í™œë™ ë¹„ì¤‘ ë¶„ì„ ìš”êµ¬ì‚¬í•­
- ìŠ¤ì¼€ì¤„ ìƒì„±ê³¼ í•¨ê»˜ ì‚¬ìš©ìì˜ í™œë™ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ í™œë™ ë¹„ì¤‘ì„ ê³„ì‚°í•´ì£¼ì„¸ìš”.
- ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ë³„ë¡œ í™œë™ ì‹œê°„ì„ ì§‘ê³„í•˜ì—¬ ë¹„ì¤‘ì„ ê³„ì‚°í•˜ì„¸ìš”:
  - work: ì—…ë¬´, ê°œë°œ, ì½”ë”©, íšŒì‚¬ ê´€ë ¨ í™œë™
  - study: ê³µë¶€, í•™ìŠµ, ì‹œí—˜ ì¤€ë¹„, ê°•ì˜ ê´€ë ¨ í™œë™
  - exercise: ìš´ë™, í—¬ìŠ¤, ëŸ¬ë‹, ìš”ê°€ ë“± ì‹ ì²´ í™œë™
  - reading: ë…ì„œ, ì±… ì½ê¸° ê´€ë ¨ í™œë™
  - hobby: ì·¨ë¯¸, ê²Œì„, ìŒì•…, ì—¬ê°€ í™œë™
  - others: ê¸°íƒ€ í™œë™ë“¤
- ê° ì¹´í…Œê³ ë¦¬ì˜ ë¹„ì¤‘ì€ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì´ í™œë™ ì‹œê°„ì„ ì „ì²´ í™œë™ ì‹œê°„ìœ¼ë¡œ ë‚˜ëˆˆ ë¹„ìœ¨ë¡œ ê³„ì‚°í•˜ì„¸ìš”.

ğŸ“¤ ì¶œë ¥ í˜•ì‹ í•„ìˆ˜ ì§€ì¹¨ (â€» ì´ ë¶€ë¶„ì´ ë§¤ìš° ì¤‘ìš”)
- ì¶œë ¥ì€ ë°˜ë“œì‹œ ì•„ë˜ì™€ ê°™ì€ **JSON í˜•ì‹ í•˜ë‚˜ë§Œ ë°˜í™˜**í•˜ì„¸ìš”.
- **ê° dayë³„ë¡œ í•˜ë‚˜ì˜ ê°ì²´**ê°€ ìˆì–´ì•¼ í•˜ë©°, ê° ê°ì²´ëŠ” ë°˜ë“œì‹œ ì•„ë˜ í•„ë“œë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
  - \`day\`: ì˜¤ëŠ˜ ê¸°ì¤€ ìƒëŒ€ ë‚ ì§œ ë²ˆí˜¸ (ì •ìˆ˜, ì˜¤ë¦„ì°¨ìˆœ)
  - \`weekday\`: í•´ë‹¹ ìš”ì¼ ì´ë¦„ (ì˜ˆ: "ìˆ˜ìš”ì¼")
  - \`activities\`: ë°°ì—´ í˜•íƒœë¡œ í™œë™ ëª©ë¡
    - ê° í™œë™ì€ \`start\`, \`end\`, \`title\`, \`type\` í•„ë“œ í¬í•¨
      - \`type\`ì€ "lifestyle" ë˜ëŠ” "task" ì¤‘ í•˜ë‚˜
- **ì ˆëŒ€ í™œë™ë³„ë¡œ days ë°°ì—´ì„ ë°˜í™˜í•˜ì§€ ë§ˆì„¸ìš”!**
- ë°˜ë“œì‹œ dayë³„ë¡œ activitiesë¥¼ ë¬¶ì–´ì„œ ë°˜í™˜í•˜ì„¸ìš”.
- ì ˆëŒ€ë¡œ "ììœ ì‹œê°„", "Free time", "ë¹ˆ ì‹œê°„" ë“±ê³¼ ê°™ì´ ì•„ë¬´ í™œë™ì´ ì—†ëŠ” ì‹œê°„ëŒ€ë¥¼ ë³„ë„ì˜ í™œë™ìœ¼ë¡œ ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”.
- ì˜¤ì§ ì‹¤ì œ í™œë™(ìˆ˜ë©´, ì‹ì‚¬, íšŒì‚¬, í•  ì¼ ë“±)ë§Œ activitiesì— í¬í•¨í•˜ì„¸ìš”.
- ë¹ˆ ì‹œê°„ì€ activities ë°°ì—´ì— í¬í•¨í•˜ì§€ ì•Šê³ , ë‹¨ìˆœíˆ ë¹„ì›Œë‘ì„¸ìš”.`;
  
    return `${prefix}
  
  [ê¸°ì¡´ ì‹œê°„í‘œ]
  ${JSON.stringify(previousSchedule, null, 2)}
  
  [ì‚¬ìš©ì í”¼ë“œë°± ë° ì¶”ê°€ í•  ì¼]
  ${lifestyleText}
  ${taskText}
  
  [ì¡°ê±´]
  - ê¸°ì¡´ í•  ì¼ê³¼ ìƒˆ í•  ì¼ì„ ë³‘í•©í•´ ì¤‘ìš”ë„ ë° ë§ˆê°ì¼ ê¸°ì¤€ìœ¼ë¡œ ì¬ì •ë ¬
  - ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì„ ê¸°ë°˜ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ì„ ì¬ì„¤ê³„í•˜ê¸°
  - ì•¼ê°„ ì‘ì—…ì´ë‚˜ ì‰¬ëŠ” ì‹œê°„ ì¡°ì • ê°™ì€ í”¼ë“œë°±ì€ ë°˜ë“œì‹œ ë°˜ì˜
  - day:ì˜¤ëŠ˜ë¶€í„° ë§ˆê°ì¼ê¹Œì§€ ì—°ì†ëœ ì¼ì •ìœ¼ë¡œ ì¶œë ¥
  - ìŠ¤ì¼€ì¤„ì´ ì¡°ê¸° ì¢…ë£Œë  ê²½ìš° ë°˜ë“œì‹œ notesì— ì´ìœ ë¥¼ ì„¤ëª…í•˜ì„¸ìš”
  - ê¸°ì¡´ í•  ì¼ì˜ ë§ˆê°ì¼ì´ ìˆ˜ì •ëœ ê²Œ ì•„ë‹Œ ì´ìƒ, ê¸°ì¡´ì˜ ë§ˆê°ì¼ì„ ë°˜ë“œì‹œ ìœ ì§€í•´ì•¼ í•˜ë©°, ì ˆëŒ€ë¡œ ë” ì¼ì° ëë‚´ì§€ ë§ˆì„¸ìš”
  - ê¸°ì¡´ ì‘ì—…ì´ day:14ê¹Œì§€ ì§„í–‰ë˜ê³  ìˆì—ˆë‹¤ë©´, ê·¸ ì‘ì—…ì€ ìµœì†Œí•œ day:14ê¹Œì§€ ê³„ì† ë°°ì¹˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
  - í”¼ë“œë°±ìœ¼ë¡œ ì¸í•´ ìƒˆ ì‘ì—…ì´ ì¶”ê°€ë˜ê±°ë‚˜ ì‹œê°„ì´ ë¶€ì¡±í•˜ë”ë¼ë„, ê¸°ì¡´ í•  ì¼ì„ ì‚­ì œí•˜ê±°ë‚˜ ì¡°ê¸° ì¢…ë£Œí•˜ì§€ ë§ˆì„¸ìš”.
  - í‰ì¼(day:1~5)ê³¼ ì£¼ë§(day:6~7)ì˜ ìƒí™œíŒ¨í„´ì´ ë‹¤ë¥¸ ê²½ìš°, ë°˜ë“œì‹œ êµ¬ë¶„í•˜ì—¬ ì ìš©í•˜ì„¸ìš”.
  - ì˜ˆë¥¼ ë“¤ì–´ "í‰ì¼ 07:00~08:00 ì•„ì¹¨ ì‹ì‚¬"ëŠ” ì˜¤ì§ ì›”~ê¸ˆì—ë§Œ ì ìš©í•˜ê³ , "ì£¼ë§ 10:00~12:00 ìš´ë™"ì€ í† ,ì¼ì—ë§Œ ì ìš©í•˜ì„¸ìš”.
  - ì–´ë–¤ ì¼ì •ë„ ì‹œê°„ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”. íŠ¹íˆ í‰ì¼/ì£¼ë§ êµ¬ë¶„ì´ ìˆëŠ” ìƒí™œíŒ¨í„´ ì¼ì •ê³¼ ë‹¤ë¥¸ í• ì¼ì´ ê²¹ì¹˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
  - ì¼ì • ê°„ ì¶©ëŒì´ ìˆì„ ê²½ìš°, ìƒí™œíŒ¨í„´ì„ ìš°ì„ í•˜ê³  í• ì¼ì€ ë‹¤ë¥¸ ì‹œê°„ëŒ€ë¡œ ì´ë™ì‹œí‚¤ì„¸ìš”.
  - âš ï¸ ì ˆëŒ€ë¡œ ì¼ì •ì„ day:7ì´ë‚˜ day:8ê¹Œì§€ë§Œ ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”. ê¸°ì¡´ ì¼ì •ì´ day:${maxDay}ê¹Œì§€ ìˆì—ˆë‹¤ë©´ ìµœì†Œ ê·¸ ë‚ ì§œê¹Œì§€ ëª¨ë“  ì¼ì •ì„ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.
  - âš ï¸ ë°˜ë“œì‹œ ê¸°ì¡´ ì¼ì •ì˜ ëª¨ë“  í™œë™ì„ í¬í•¨í•˜ì—¬ ìµœì†Œí•œ day:${maxDay}ê¹Œì§€ ìŠ¤ì¼€ì¤„ì„ ìƒì„±í•˜ì„¸ìš”.
  - ìƒëŒ€ì  ë‚ ì§œ í‘œí˜„("ì´ë²ˆì£¼ í† ìš”ì¼", "ë‹¤ìŒì£¼ ìˆ˜ìš”ì¼" ë“±)ì€ ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì •í™•íˆ ê³„ì‚°í•´ì„œ ì ìš©í•˜ì„¸ìš”.
  - ì¤‘ìš”: ë‚ ì§œ í‘œí˜„ ë’¤ì— "(day:X)" í˜•ì‹ìœ¼ë¡œ ì´ë¯¸ ê³„ì‚°ëœ ë‚ ì§œê°€ ìˆë‹¤ë©´, ë°˜ë“œì‹œ ê·¸ ê°’ì„ ì‚¬ìš©í•˜ì„¸ìš”.
    ì˜ˆ: "ë‹¤ìŒì£¼ ìˆ˜ìš”ì¼ (day:12)"ì´ë¼ë©´ ë°˜ë“œì‹œ day:12ë¥¼ ë§ˆê°ì¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.`;
  }
  
  // GPT ì‘ë‹µ êµ¬ì¡°ë¥¼ í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°ë¡œ ë³€í™˜
  export function flattenSchedule(gptResponse) {
    if (!gptResponse || !gptResponse.schedule || !Array.isArray(gptResponse.schedule)) {
      console.warn('flattenSchedule: ìœ íš¨í•˜ì§€ ì•Šì€ gptResponse', gptResponse);
      return [];
    }

    const dayMap = new Map(); // dayë³„ë¡œ activitiesë¥¼ ê·¸ë£¹í™”

    gptResponse.schedule.forEach(activityBlock => {
      if (!activityBlock.days || !Array.isArray(activityBlock.days)) {
        console.warn('flattenSchedule: activityBlock.daysê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ', activityBlock);
        return;
      }

      activityBlock.days.forEach(dayInfo => {
        if (!dayInfo.day || !dayInfo.start || !dayInfo.end) {
          console.warn('flattenSchedule: dayInfoê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ', dayInfo);
          return;
        }

        const day = dayInfo.day;
        if (!dayMap.has(day)) {
          dayMap.set(day, {
            day: day,
            weekday: getKoreanDayName(day),
            activities: []
          });
        }

        dayMap.get(day).activities.push({
          start: dayInfo.start,
          end: dayInfo.end,
          title: dayInfo.title || activityBlock.title || activityBlock.activity,
          type: dayInfo.type || activityBlock.type || 'task'
        });
      });
    });

    // day ìˆœì„œëŒ€ë¡œ ì •ë ¬í•˜ì—¬ ë°˜í™˜
    return Array.from(dayMap.values()).sort((a, b) => a.day - b.day);
  }

  // day ë²ˆí˜¸ë¥¼ í•œêµ­ì–´ ìš”ì¼ë¡œ ë³€í™˜
  function getKoreanDayName(day) {
    const dayNames = ['', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼', 'ì¼ìš”ì¼'];
    return dayNames[day] || 'ì•Œ ìˆ˜ ì—†ìŒ';
  }

  // GPT â†’ FullCalendar ì´ë²¤íŠ¸ ë³€í™˜ê¸°
  export function convertScheduleToEvents(gptSchedule, today = new Date()) {
    const events = [];
    
    // gptScheduleì´ GPT ì‘ë‹µ êµ¬ì¡°ì¸ì§€ í™•ì¸í•˜ê³  ë³€í™˜
    let scheduleData = gptSchedule;
    if (gptSchedule && gptSchedule.schedule) {
      // GPT ì‘ë‹µ ê°ì²´ êµ¬ì¡°
      scheduleData = flattenSchedule(gptSchedule);
    } else if (Array.isArray(gptSchedule) && gptSchedule.length > 0 && Array.isArray(gptSchedule[0]?.days)) {
      // í™œë™ ë¸”ë¡ ë°°ì—´ êµ¬ì¡° (í™œë™ë³„ days í¬í•¨) -> ìë™ í‰íƒ„í™”
      scheduleData = flattenSchedule({ schedule: gptSchedule });
    }
    
    // ë°©ì–´ ì½”ë“œ: scheduleDataê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë°°ì—´ ë°˜í™˜
    if (!scheduleData || !Array.isArray(scheduleData) || scheduleData.length === 0) {
      console.warn('convertScheduleToEvents: ìœ íš¨í•˜ì§€ ì•Šì€ scheduleData', scheduleData);
      return events;
    }
    
    const gptDayToday = scheduleData[0]?.day;
    
    // ì²« ë²ˆì§¸ ìš”ì†Œì— day ì†ì„±ì´ ì—†ìœ¼ë©´ ì—ëŸ¬
    if (typeof gptDayToday !== 'number') {
      console.warn('convertScheduleToEvents: scheduleData[0].dayê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ', scheduleData[0]);
      return events;
    }

    scheduleData.forEach(dayBlock => {
      // dayBlockì´ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ê±´ë„ˆë›°ê¸°
      if (!dayBlock || typeof dayBlock.day !== 'number') {
        console.warn('convertScheduleToEvents: ìœ íš¨í•˜ì§€ ì•Šì€ dayBlock', dayBlock);
        return;
      }
      
      const dateOffset = dayBlock.day - gptDayToday;
      const targetDate = new Date(today);
      targetDate.setDate(today.getDate() + dateOffset);
      const dateStr = formatLocalISO(targetDate).split('T')[0];

      // activitiesê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ê±´ë„ˆë›°ê¸°
      if (!dayBlock.activities || !Array.isArray(dayBlock.activities)) {
        console.warn('convertScheduleToEvents: dayBlock.activitiesê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ', dayBlock);
        return;
      }

      dayBlock.activities.forEach(activity => {
        // activityê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ê±´ë„ˆë›°ê¸°
        if (!activity || !activity.start || !activity.end || !activity.title) {
          console.warn('convertScheduleToEvents: ìœ íš¨í•˜ì§€ ì•Šì€ activity', activity);
          return;
        }
        
        const start = new Date(`${dateStr}T${activity.start}`);
        let end = new Date(`${dateStr}T${activity.end}`);
        const extendedProps = {
          type: activity.type || "task"
        };

        if (end < start) {
          const startOfToday = resetToStartOfDay(start);
          const endOfToday = resetToStartOfDay(start, true);

          events.push({
            title: activity.title,
            start: formatLocalISO(startOfToday),
            end: formatLocalISO(end),
            extendedProps
          });

          events.push({
            title: activity.title,
            start: formatLocalISO(start),
            end: formatLocalISO(endOfToday),
            extendedProps
          });
          return;
        }

        events.push({
          title: activity.title,
          start: formatLocalISO(start),
          end: formatLocalISO(end),
          extendedProps
        });
      });
    });

    return events;
  }
  
// ë‚ ì§œë¥¼ day ì¸ë±ìŠ¤ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (ì˜¤ëŠ˜ë¶€í„° ìƒëŒ€ì ì¸ ì¼ìˆ˜)
export function convertToRelativeDay(targetDate, baseDate = new Date()) {
  if (!targetDate) return null;
  
  const startOfBaseDate = resetToStartOfDay(baseDate);
  const startOfTargetDate = resetToStartOfDay(targetDate);
  
  // ë‚ ì§œ ì°¨ì´ë¥¼ ë°€ë¦¬ì´ˆë¡œ ê³„ì‚° í›„ ì¼ìˆ˜ë¡œ ë³€í™˜
  const diffTime = startOfTargetDate.getTime() - startOfBaseDate.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  // ì˜¤ëŠ˜ì˜ GPT day ì¸ë±ìŠ¤
  const todayGptDay = getGptDayIndex(baseDate);
  
  // ìƒëŒ€ì  day ê°’ ë°˜í™˜
  return todayGptDay + diffDays;
}
  